{% extends "base.html" %}
{% block content %}

<h2 class="page-title">Dashboard Statistik Mahasiswa</h2>

<!-- ================= RINGKASAN ================= -->
<div class="dashboard-grid">

    <div class="card summary">
        <h3>Total Mahasiswa</h3>
        <p class="value">{{ total }}</p>
    </div>

    <div class="card summary">
        <h3>Rata-rata IPK</h3>
        <p class="value">{{ avg_ipk }}</p>
    </div>

    <div class="card summary wide">
        <h3>Jumlah Mahasiswa per Jurusan</h3>
        <ul class="jurusan-list">
            {% for jurusan, jumlah in per_jurusan.items() %}
                <li>{{ jurusan }} <span>{{ jumlah }}</span></li>
            {% endfor %}
        </ul>
    </div>

</div>

<!-- ================= TABEL ================= -->
<div class="card wide mt">
    <h3>Tabel Statistik Mahasiswa</h3>
    <table class="table">
        <thead>
            <tr>
                <th>No</th>
                <th>Jurusan</th>
                <th>Jumlah Mahasiswa</th>
            </tr>
        </thead>
        <tbody>
            {% for jurusan, jumlah in per_jurusan.items() %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ jurusan }}</td>
                <td>{{ jumlah }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ================= GRAFIK ================= -->
<div class="card wide mt chart-card">
    <h3 class="chart-title">Grafik Distribusi Mahasiswa per Jurusan</h3>
    <div class="chart-wrapper">
        <canvas id="jurusanChart"></canvas>
    </div>
</div>

<!-- ================= CHART JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const dataJurusan = {{ per_jurusan | tojson | safe }};
    const ctx = document.getElementById("jurusanChart");

    if (window.chartInstance) {
        window.chartInstance.destroy();
    }

    window.chartInstance = new Chart(ctx, {
        type: "doughnut",
        data: {
            labels: Object.keys(dataJurusan),
            datasets: [{
                data: Object.values(dataJurusan),
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            cutout: "65%",
            plugins: {
                legend: {
                    position: "bottom",
                    labels: {
                        padding: 15,
                        boxWidth: 14
                    }
                }
            }
        }
    });
</script>

{% endblock %}
